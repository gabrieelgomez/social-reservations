%section#seach-widget
  .container
    - unless @results.blank?
      .box-search
        .container
          .row.row-flex
            .col-lg-9
              .row
                .items-search
                  .col-lg-12
                    %span
                      Su búsqueda:
                  .col-lg-4
                    %span
                      ="Destino: #{@results.title[@lang]}".titleize
                  .col-lg-4
                    %span
                      ="Fecha: #{@flight_origin_multidestination_picker}"
                  .col-lg-2
                    %span
                      ="Adultos: #{@adults}"
                  .col-lg-2
                    %span
                      ="Niños: #{@kids}"

            .col-lg-3
              %p
                %span
                  %a.pull-right.link-widget
                    Volver a relizar la búsqueda

  .container.js-widget.js-hide-widget.widget-results
    .row
      .col-lg-12
        = render 'app/layouts/widget'
%br
%br

%section#multidestinations.multidestinations
  - unless @results.blank?
    .banner-multidestinations{:style => "background-image: url(#{@results.banner.url})"}
      .banner-multidestinations--mask
        %h2= @results.title[@lang].titleize
        %p= @results.subtitle[@lang].titleize
        
  .content-multidestinations
    .container
      .row
        - if @results.blank?
          .col-lg-12
            .box-results
              .image-search
                = image_tag '/assets/img/loupe.svg'
              .gallary-header.text-center
                %h2
                  ¡Lo sentimos! No hemos encontrado ningún resultado.
                %p
                  = link_to root_path do
                    Volver a relizar la búsqueda
        - else
          .col-xs-12.col-sm-12.col-md-6.col-lg-7
            .content-multidestinations__description
              %h3 Descripción
              .content-multidestinations__description--summary
                %p= raw @results.description[@lang]
            .content-multidestinations__button
              .row
                .col-lg-12
                  %center
                    %span.price
                      Costo por persona:
                      %h3.price
                        Desde
                        = number_to_currency(@results.low_price(@currency), locale: @locale)
                -# User click from a Cards - Condition
                - unless @flight_origin_multidestination_picker
                  .col-lg-offset-2.col-lg-8
                    = search_form_for @q, url: "/#{@lang}/#{@currency}/reservations/multidestination/#{@results.id}", html: {class: 'input-group', style:'width: 100%;', id: 'search-metadata', method: :get } do |f|
                      .row
                        %center
                          .col-lg-6
                            .form-group
                              %input.form-control{name: 'flight_multidestination_data', id: 'flight_multidestination_data', autocomplete: 'off', style:'border-radius: 6px;'}/
                          .col-lg-3
                            .form-group
                              %input.form-control{name: 'quantity_adults', :type => "number", min: 1, value: 2, :placeholder => "Adultos" , style:'border-radius: 6px;'}/
                          .col-lg-3
                            .form-group
                              %input.form-control{name: 'quantity_kids', :type => "number", min: 0, :placeholder => "Niños" , style:'border-radius: 6px;'}/
                      .col-lg-12
                        %br
                        %center
                          %button.about-view.packages-btn.btn-reservation{style: 'width: 165px;height: 48px;font-size: 14px;', type: 'submit'}
                            solicitar
                            %br/
                            reservación
                - else
                  .col-lg-12
                    %br
                    %center
                      = link_to reservations_path(@lang, @currency, 'multidestination', @results, multidestination: @results.title['es'], quantity_adults: @adults, quantity_kids: @kids, flight_origin_multidestination_picker: @flight_origin_multidestination_picker) do
                        %button.about-view.packages-btn.btn-reservation
                          solicitar
                          %br/
                          reservación

          .col-xs-12.col-sm-12.col-md-6.col-lg-5
            .content-.visible-xs.visible-sm
              %h3 Galería de Imágenes
            .content-multidestinations__image
              .carrusel-galery
                .galery_multidestinations
                  - @results.files.each_with_index do |image|
                    .galery__item
                      %img{:alt => "", :src => image.url, :class => "img-responsive"}/

          .col-xs-12.col-sm-12-col-md-12.col-lg-12
            .content-multidestinations__tab
              .content-multidestinations__tab--box
                %ul.nav.nav-tabs.nav-item-multidestinations
                  %li.active
                    %a{"data-toggle" => "tab", :href => "#information"} Información
                  %li
                    %a{"data-toggle" => "tab", :href => "#includes"} Incluye
                  %li
                    %a{"data-toggle" => "tab", :href => "#excludes"} No Incluye
                  %li
                    %a{"data-toggle" => "tab", :href => "#itinerary"} Itinerario
                  %li
                    %a{"data-toggle" => "tab", :href => "#rooms_prices"} Habitaciones
                .tab-content
                  #information.tab-pane.active
                    .box-information
                      %h4 Información
                      %p= raw @results.description[@lang]

                  #includes.tab-pane
                    .box-includes
                      %h4 Incluye
                      %p= raw @results.include[@lang]

                  #excludes.tab-pane
                    .box-excludes
                      %h4 No Incluye
                      %p= raw @results.exclude[@lang]

                  #itinerary.tab-pane
                    .box-description
                      %h4 Itinerario
                      %p= raw @results.itinerary[@lang]

                  #rooms_prices.tab-pane
                    .box-rooms_prices
                      %h4.text-center Habitaciones
                      .row
                        .col-lg-12
                          %table.table.table-hover.table-room
                            %thead
                              %tr
                                %th Hotel
                                %th Simple
                                %th Doble
                                %th Triple
                                %th Cuádruple
                                %th Quíntuple
                                %th Sextuple
                                %th Precio por niño
                            %tbody
                              - @results.multidestinationables.each do |multidestinationable|
                                - lodgment = multidestinationable.lodgment
                                - if multidestinationable.status
                                  %tr
                                    %td= multidestinationable.lodgment.title[@lang]
                                    - multidestinationable.multidestinationable_rooms.sort_by{|room| room.id }.each do |room|
                                      - price = room.try("price_#{@currency}")
                                      - room_disabled = lodgment.disabled_room(room)
                                      - if price.zero? || room === false || room_disabled != false
                                        %td No Disponible
                                      - else multidestinationable.lodgment.avaible_room? room
                                        %td= number_to_currency(room.try("price_#{@currency}"), locale: @locale)

:javascript
  // multidestinations
  $( function() {
    function populateEndDate() {
      var date2 = $('#flight_multidestination_data').datetimepicker('getDate');
      date2.setDate(date2.getDate() + 3);
    }

    $("#flight_multidestination_data").datetimepicker({
      dateFormat: "dd-mm-yy",
      minDate: 3,
      onSelect: function(date) {
        populateEndDate();
        var date = $('#flight_multidestination_data').val();
        $('#reservation_flight_origin_data').val(date);
      }
    }).datetimepicker("setDate", new Date());
  } );
  // End --- multidestinations

  $('#search-metadata').validate({
    event: "blur",
    errorClass: "error-class",
    validClass: "valid-class",
    rules: {
      'flight_multidestination_data': { required: true},
      'quantity_adults': { required: true},
    },
    messages: {
      'flight_multidestination_data': 'No puede estar en blanco',
      'quantity_adults': 'No puede estar en blanco'
    },
    debug: true,
    errorElement: "label",
    submitHandler: function (form) {
      form.submit();
    }

  });
