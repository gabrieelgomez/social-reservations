%link{:href => "https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css", :rel => "stylesheet"}/
%script{:src => "https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"}


= simple_form_for [:admin, :travel, @transfer] do |f|
  .container
    .row
      .col-lg-2
        = link_to admin_travel_transfers_path, class: "", "data-position" => "bottom", "data-tooltip" => t("keppler.actions.back") do
          .arrow-back.btn.btn-default
            %i.fa.fa-angle-left
            = t('keppler.actions.back')

    .row
      .col-lg-12
        .box.slice-box
          .box-header.with-border
            %h3.box-title= t("keppler.modules.#{action_name.underscore}")
            .box-tools.pull-right
              %a.btn.btn-box-tool{"data-widget" => "collapse", :type => "button"}
                %i.fa.fa-minus
          .box-body
            %table.table.table-bordered
              %tbody
                .form-padding

                  // Cover
                  .col-xs-12.col-md-12
                    .col-md-4{style: 'margin:20px'}
                      = f.input :cover, as: :keppler_file, label: false

                  // Field multilanguage
                  .col-xs-12.col-md-12
                    .nav-tabs-custom
                      %ul.nav.nav-tabs
                        %li.active
                          %a{"data-toggle" => "tab", :href => "#spanish"} Español
                        %li
                          %a{"data-toggle" => "tab", :href => "#english"} Inglés
                        %li
                          %a{"data-toggle" => "tab", :href => "#portugues"} Portugués
                      .tab-content{style: 'padding:inherit!important;margin-bottom:10px;'}

                        // ESPAÑOL
                        #spanish.tab-pane.active
                          .col-xs-12
                            = f.simple_fields_for :title, OpenStruct.new(@transfer.title) do |field|
                              = field.input :es, label: 'Titulo Español'
                          .col-xs-12
                            = f.simple_fields_for :description, OpenStruct.new(@transfer.description) do |field|
                              = field.input :es, label: 'Descripción Español', as: :ckeditor, input_html: { ckeditor: { toolbar: 'mini'} }

                        // INGLÉS
                        #english.tab-pane
                          .col-xs-12
                            = f.simple_fields_for :title, OpenStruct.new(@transfer.title) do |field|
                              = field.input :en, label: 'Titulo Inglés'
                          .col-xs-12
                            = f.simple_fields_for :description, OpenStruct.new(@transfer.description) do |field|
                              = field.input :en, label: 'Descripción Inglés', as: :ckeditor, input_html: { ckeditor: { toolbar: 'mini'} }

                        // PORTUGUÉS
                        #portugues.tab-pane
                          .col-xs-12
                            = f.simple_fields_for :title, OpenStruct.new(@transfer.title) do |field|
                              = field.input :pt, label: 'Titulo Portugués'
                          .col-xs-12
                            = f.simple_fields_for :description, OpenStruct.new(@transfer.description) do |field|
                              = field.input :pt, label: 'Descripción Portugués', as: :ckeditor, input_html: { ckeditor: { toolbar: 'mini'} }


                  .col-xs-12.col-md-3
                    = f.input :quantity_person, label: 'Cantidad de personas', input_html: { min: '1', type: 'number' }
                  .col-xs-12.col-md-8
                    = f.simple_fields_for :price, OpenStruct.new(@transfer.price) do |field|
                      .col-xs-4
                        = field.input :cop, label: 'Precio COP', input_html: { min: '1', type: 'number' }
                      .col-xs-4
                        = field.input :usd, label: 'Precio USD', input_html: { min: '1', type: 'number' }

                        -# = f.association :destinations#, label_method: lambda { |subcat| "<b>#{subcat.category.title}</b> / #{subcat.title}".html_safe }
                  .col-xs-6
                    %label Destinos
                    -# %select.js-example-basic-single{style: 'width:100%;', :name => "state", multiple: "multiple"}
                    -#   %optgroup{:label => "USA"}
                    -#     %option{:value => "1"} New York
                    -#     %option{:value => "2"} Kansas
                    -#   %optgroup{:label => "Venezuela"}
                    -#     %option{:value => "3"} Caracas
                    -#     %option{:value => "4"} Punto Fijo
                    %select.js-example-basic-single{id: 'destinations_transfers', style: 'width:100%;', name: 'destinations', multiple: "multiple"}
                      - KepplerTravel::Destination.all.each do |collection|
                        %option{ value: collection.id }= collection.title

                    -# %select{style: 'display:none;', name: 'transfer[destinations][]', id: 'destinations_transfers', multiple: true }
                    -#   - KepplerTravel::Destination.all.each do |collection|
                    -#     %option{ value: collection.id }= collection.title

                  -# .col-xs-4
                  -#   %select#destinations_transfers{:multiple => "multiple"}
                  -#     %optgroup{:label => "test"}
                  -#       %option{:value => "testoption"} Test Option
                  -#       %option{:value => "testoption2"} Test Option2


                    = f.input :position, as: :hidden
                  .col-xs-4
                    = f.input :deleted_at, as: :hidden
                  .col-xs-12
                    .pull-right
                      = f.button :submit, t('keppler.actions.save'), name: '_save', class: 'btn-primary'
                      = f.button :submit, t('keppler.actions.save_and_add_another'), name: '_add_other'

:javascript
  // $( "#destinations_transfers" ).select2();

  $(document).ready(function() {
    $('#destinations_transfers').select2();
  });
- if action_name == 'new'
  :javascript

    $(document).ready(function() {

      $("#new_transfer").validate({
       event: "blur",
       errorClass: "error-class",
       validClass: "valid-class",
       rules: {
         'transfer[quantity_person]': { required: true}
         },
       messages: {
         'transfer[quantity_person]': 'No puede estar en blanco'
         },
       debug: true,errorElement: "label",
       submitHandler: function(form){
         var data = $('#destinations_transfers').val();
         $('form').append(`<input type="hidden" name="transfer[destination_ids]" value="${data}" /> `);
         form.submit();

       }
      });
    });

- if action_name == 'edit'
  :javascript
    var transfer_id = #{raw @transfer.id};
    $(`#edit_transfer_${transfer_id}`).validate({
     event: "blur",
     errorClass: "error-class",
     validClass: "valid-class",
     rules: {
       'transfer[quantity_person]': { required: true}
       },
     messages: {
       'transfer[quantity_person]': 'No puede estar en blanco'
       },
     debug: true,errorElement: "label",
     submitHandler: function(form){
       var data = $('#destinations_transfers').val();
       $('form').append(`<input type="hidden" name="transfer[destination_ids]" value="${data}" /> `);
       form.submit();
     }
    });

:scss
  label.error-class{color: #e60707 !important;}
